<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø¢Ù¾Ø§Ø¯Ø§Ù†Ø§ â€” Ù†Ø³Ø®Ù‡ ÙˆØ¨â€ŒÙˆÛŒÙˆ Ù¾ÙˆÛŒØ§</title>
<link rel="stylesheet" href="CSS/app.css" />
</head>
<body>

<header class="header">
  <div class="left">
    <button class="start-btn" id="startBtn" title="Ø´Ø±ÙˆØ¹ Ú©Ù†!">
      <span class="icon" id="startIcon">âœˆ</span>
      <span>Ø´Ø±ÙˆØ¹ Ú©Ù†!</span>
    </button>
  </div>
</header>

<div class="container">
  <div class="slider" id="slider">
    <div class="slides" id="slides">
      <div class="slide" style="background-image:url('__REPLACE_IMG_SLIDE_1__')"></div>
      <div class="slide" style="background-image:url('__REPLACE_IMG_SLIDE_2__')"></div>
      <div class="slide" style="background-image:url('__REPLACE_IMG_SLIDE_3__')"></div>
    </div>
    <div class="indicators" id="indicators">
      <button data-i="0" class="active"></button>
      <button data-i="1"></button>
      <button data-i="2"></button>
    </div>
  </div>
  
  <section>
    <h3 style="margin:14px 0 6px 0; padding-left:6px">Ù¾Ø§ØªÙˆÙ‚â€ŒÙ‡Ø§</h3>
    <div class="actions-grid" id="actionsGrid"></div>
  </section>
</div>

<nav class="footer">
  <button class="fbtn" data-action="home"><div class="fi">ğŸ </div><div>Ø®Ø§Ù†Ù‡</div></button>
  <button class="fbtn" data-action="actions"><div class="fi">ğŸ—‚ï¸</div><div>Ù¾Ø§ØªÙˆÙ‚â€ŒÙ‡Ø§</div></button>
  <button class="fbtn" data-action="explore"><div class="fi">ğŸ”</div><div>Ú©Ø§ÙˆØ´</div></button>
  <button class="fbtn" data-action="profile"><div class="fi">ğŸ‘¤</div><div>Ù¾Ø±ÙˆÙØ§ÛŒÙ„</div></button>
</nav>

<div class="overlay" id="overlay">
  <div class="modal" role="dialog" aria-modal="true" id="modal">
    <div class="head">
      <strong id="modalTitle">Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§ØªÙˆÙ‚</strong>
      <button id="modalClose" aria-label="Ø¨Ø³ØªÙ†">âœ–</button>
    </div>
    <img id="modalImage" src="" alt="ØªØµÙˆÛŒØ± Ù¾Ø§ØªÙˆÙ‚">
    <p id="modalDesc" style="color:#444"></p>
    <div style="display:flex;gap:10px;margin-top:12px;">
      <button id="doAction" class="start-btn" style="flex:1">Ø§Ù†Ø¬Ø§Ù… Ú©Ù† Ùˆ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ú¯ÛŒØ±</button>
      <button id="gotoActionPage" style="flex:1;border-radius:10px;border:1px solid #ddd;background:#fff;">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØµÙØ­Ù‡Ù” Ù¾Ø§ØªÙˆÙ‚</button>
    </div>
  </div>
</div>

<script>
const ACTIONS=[
  {id:1,title:'Ø¯ÙˆØ¨Ù„Ù‡ Ø¨Ø§Ø­Ø§Ù„',desc:'ØµØ¯Ø§ØªÙˆ Ø¶Ø¨Ø· Ú©Ù† Ùˆ Ø¯ÙˆØ¨Ù„Ù‡ Ú©Ù†ØŒ Ø®Ù„Ø§ØµÙ‡ Ø­Ø§Ù„ Ú©Ù†!',img:'__REPLACE_ACTION_IMG_1__',points:10},
  {id:2,title:'Ù†Ù‚Ø§Ø´ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„',desc:'ÛŒÙ‡ Ø§Ø«Ø± Ú©ÙˆÚ†ÛŒÚ© Ø¨Ø³Ø§Ø² Ùˆ Ù†Ø´ÙˆÙ†Ù…ÙˆÙ† Ø¨Ø¯Ù‡',img:'__REPLACE_ACTION_IMG_2__',points:8},
  {id:3,title:'ÙˆÛŒØ¯ÛŒÙˆ Ú©ÙˆØªØ§Ù‡',desc:'Ú©Ù„ÛŒÙ¾ Ú©ÙˆØªØ§Ù‡ Ø¨Ø³Ø§Ø² Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†',img:'__REPLACE_ACTION_IMG_3__',points:12},
];
let USER=JSON.parse(localStorage.getItem('apadana_user'))||{name:null,score:0,history:[]};
function saveUser(){localStorage.setItem('apadana_user',JSON.stringify(USER));}

const grid=document.getElementById('actionsGrid');
function renderCards(){
  grid.innerHTML='';
  ACTIONS.forEach(a=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <img class="thumb" src="${a.img}" alt="${a.title}">
      <h4>${a.title}</h4>
      <p>${a.desc}</p>
      <button class="discover" data-id="${a.id}">Ú©Ø´ÙØ´ Ú©Ù†! ğŸ§³</button>
    `;
    grid.appendChild(card);
  });
  document.querySelectorAll('.discover').forEach(btn=>{
    btn.addEventListener('click',()=>openModal(parseInt(btn.dataset.id)));
  });
}
renderCards();

const overlay=document.getElementById('overlay');
const modalTitle=document.getElementById('modalTitle');
const modalImage=document.getElementById('modalImage');
const modalDesc=document.getElementById('modalDesc');
const doActionBtn=document.getElementById('doAction');
const gotoActionPageBtn=document.getElementById('gotoActionPage');
let currentAction=null;

function openModal(id){
  const act=ACTIONS.find(x=>x.id===id);if(!act)return;
  currentAction=act;
  modalTitle.textContent=act.title;
  modalImage.src=act.img||'';
  modalDesc.textContent=act.desc;
  overlay.classList.add('show');
  doActionBtn.onclick=()=>{
    if(!USER.name){promptLogin();return;}
    USER.score=(USER.score||0)+(act.points||0);
    USER.history=USER.history||[];
    USER.history.push({id:act.id,title:act.title,at:new Date().toISOString(),points:act.points});
    saveUser();
    alert('Ø¢ÙØ±ÛŒÙ†! '+(act.points||0)+' Ø§Ù…ØªÛŒØ§Ø² Ú¯Ø±ÙØªÛŒ â€” Ø§Ù„Ø§Ù†: '+USER.score);
    overlay.classList.remove('show');
  };
  gotoActionPageBtn.onclick=()=>{
    window.location.hash='action-'+act.id;
    overlay.classList.remove('show');
    showActionPage(act);
  };
}
document.getElementById('modalClose').onclick=()=>overlay.classList.remove('show');

function showActionPage(act){alert('ØµÙØ­Ù‡Ù” Ù¾Ø§ØªÙˆÙ‚: '+act.title+'\n'+(act.desc||'ØªÙˆØ¶ÛŒØ­ÛŒ Ù†ÛŒØ³Øª.'));}

function promptLogin(){
  const name=prompt('Ø§Ø³Ù… Ø®ÙˆØ¯ØªÙˆ Ø¨Ø°Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹: Ø³Ø§Ø±Ø§)')||null;
  if(!name)return;
  USER.name=name;
  USER.score=USER.score||0;
  USER.history=USER.history||[];
  saveUser();
  renderTopBadge();
}

function openProfile(){
  const name=USER.name||'Ù…Ù‡Ù…Ø§Ù†';
  const score=USER.score||0;
  const hist=(USER.history&&USER.history.length)?USER.history.map(h=>`${h.title} (+${h.points})`).join('\n'):'Ù‡ÛŒÚ†Ú©Ø¯ÙˆÙ…';
  alert(`Ù¾Ø±ÙˆÙØ§ÛŒÙ„:\nØ§Ø³Ù…: ${name}\nØ§Ù…ØªÛŒØ§Ø²: ${score}\nÚ©Ù†Ø´â€ŒÙ‡Ø§:\n${hist}`);
}

function renderTopBadge(){
  const hb=document.getElementById('startBtn');
  if(USER&&USER.name){hb.innerHTML=`<span class="icon">ğŸ‘‹</span><span>Ø³Ù„Ø§Ù…ØŒ ${USER.name.split(' ')[0]}!</span>`;}
  else{hb.innerHTML=`<span class="icon">âœˆ</span><span>Ø´Ø±ÙˆØ¹ Ú©Ù†!</span>`;}
}

function init(){renderTopBadge();renderCards();USER=JSON.parse(localStorage.getItem('apadana_user'))||USER;}
init();

document.getElementById('startBtn').addEventListener('click',()=>{
  if(USER&&USER.name){document.querySelector('.container').scrollIntoView({behavior:'smooth'});}
  else{promptLogin();renderTopBadge();}
});

/* Slider indicators */
const indicators=document.getElementById('indicators');
const slidesEl=document.getElementById('slides');
indicators.querySelectorAll('button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const i=parseInt(btn.dataset.i);
    slidesEl.style.animation='none';
    slidesEl.style.transform=`translateX(${-100*i}%)`;
    indicators.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    setTimeout(()=>{
      slidesEl.style.animation='slideAnim 12s linear infinite';
      slidesEl.style.transform='';
      indicators.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      indicators.querySelectorAll('button')[0].classList.add('active');
    },5000);
  });
});

/* Footer SPA-like */
document.querySelectorAll('.footer .fbtn').forEach(b=>{
  b.addEventListener('click',()=>{
    const a=b.dataset.action;
    if(a==='home'){window.scrollTo({top:0,behavior:'smooth'});}
    else if(a==='actions'){document.querySelector('.container').scrollIntoView({behavior:'smooth'});}
    else if(a==='explore'){alert('ØµÙØ­Ù‡Ù” Ú©Ø§ÙˆØ´ â€” Ø¨Ø¹Ø¯Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯');}
    else if(a==='profile'){openProfile();}
  });
});
</script>

</body>
</html>
